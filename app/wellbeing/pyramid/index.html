<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0" />
    <title>Maslow's Pyramid</title>
    <load-resources></load-resources>
    <script
      src="../../frame.webcomponent.js"
      defer></script>
    <link rel="stylesheet" href="pyramid.css" />
  </head>
  <body class="min-vh-100">
    <frame-component
      type="header"
      home-text="What to do when feeling bad or stressed.">
    </frame-component>
    <div class="container text-center">
      <div class="row justify-content-center">
        <div class="col-12 col-md-8 col-lg-6">
          <div class="pyramid-container mx-auto">
            <div
              class="level level-5"
              id="level-5"
              data-desc="desc-5">
              Self-Actualization
            </div>
            <div
              class="level level-4"
              id="level-4"
              data-desc="desc-4">
              Esteem
            </div>
            <div
              class="level level-3"
              id="level-3"
              data-desc="desc-3">
              Belonging
            </div>
            <div
              class="level level-2"
              id="level-2"
              data-desc="desc-2">
              Safety
            </div>
            <div
              class="level level-1"
              id="level-1"
              data-desc="desc-1">
              Physiological
            </div>
          </div>
        </div>
      </div>
      <div class="row justify-content-center mt-4">
        <div class="col-12 col-md-8 col-lg-6">
          <div id="tooltip-container"></div>
        </div>
      </div>
    </div>
    <frame-component type="footer"> </frame-component>
    <script src="../../resources.webcomponent.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"></script>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        let levels = [];
        const tooltipContainer = document.getElementById('tooltip-container');
        const levelElements = document.querySelectorAll('.level');

        fetch('pyramid.json')
          .then(response => response.json())
          .then(data => {
            levels = data;
            setTimeout(() => {
              const bottomLevel = document.getElementById('level-1');
              bottomLevel.classList.add('active');
              updateTooltip(levels[0]);
            }, 1500);
          });

        const updateTooltip = (levelData) => {
          let questionsHtml = '';
          if (levelData.questions && levelData.questions.length > 0) {
            questionsHtml = '<ul class="list-group list-group-flush text-start">' + levelData.questions.map(q => `<li class="list-group-item">${q}</li>`).join('') + '</ul>';
          }
          tooltipContainer.innerHTML = `
            <div class="card">
              <div class="card-header text-white desc-${levelData.id.split('-')[1]}">
                ${levelData.text}
              </div>
              <div class="card-body">
                <p class="card-text">${levelData.desc}</p>
                ${questionsHtml}
              </div>
            </div>`;
        };

        const resetTooltip = () => {
          tooltipContainer.innerHTML = '';
        };

        const resetLevels = () => {
          levelElements.forEach(level => level.classList.remove('active'));
        };

        levelElements.forEach(level => {
          level.addEventListener('click', () => {
            const levelIndex = level.id.split('-')[1];
            const levelData = levels.find(l => l.id === level.id);

            resetLevels();
            level.classList.add('active');

            if(levelData) {
              updateTooltip(levelData);
            }
          });
        });

        document.addEventListener('click', event => {
          if (!event.target.closest('.pyramid-container') && !event.target.closest('#tooltip-container')) {
            resetTooltip();
            resetLevels();
          }
        });
      });
    </script>
  </body>
</html>
